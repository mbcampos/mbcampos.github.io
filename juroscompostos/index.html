<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Juros Compostos</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="apple-touch-icon" href="favicon.svg">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background: #f8f9fb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
    }

    .container {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0px 3px 12px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 600px;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 10px;
      color: #2c3e50;
      text-align: center;
    }

    p {
      font-size: 14px;
      color: #555;
      margin-bottom: 20px;
      text-align: center;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-group label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
      color: #333;
    }

    .input-group input, .input-group select {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .periodo-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .periodo-group select {
      width: 35%;
      flex-shrink: 0;
    }

    .periodo-group input {
      width: 65%;
      flex-grow: 1;
    }

    .btn {
      width: 100%;
      background: #3949ab;
      color: #fff;
      padding: 15px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.3s;
    }

    .btn:hover {
      background: #303f9f;
    }

    .resultado {
      margin-top: 20px;
      font-size: 16px;
      font-weight: bold;
      color: #2c3e50;
      padding: 12px;
      background: #ecf0f1;
      border-radius: 6px;
      word-break: break-word;
    }

    .erro {
      margin-top: 20px;
      font-size: 14px;
      color: #e74c3c;
      padding: 12px;
      background: #fdf2f2;
      border: 1px solid #f5c6cb;
      border-radius: 6px;
      display: none;
      white-space: pre-line;
    }

    .input-group input.erro-campo, .input-group select.erro-campo {
      border-color: #e74c3c;
      background-color: #fdf2f2;
    }

    canvas {
      margin-top: 20px;
      max-width: 100%;
      height: auto;
    }

    /* RESPONSIVIDADE PARA SMARTPHONES */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 20px;
        margin: 10px;
        border-radius: 8px;
      }

      h1 {
        font-size: 20px;
        margin-bottom: 8px;
      }

      p {
        font-size: 13px;
        margin-bottom: 15px;
      }

      .input-group {
        margin-bottom: 18px;
      }

      .input-group label {
        font-size: 13px;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .input-group input, .input-group select {
        padding: 14px;
        font-size: 16px; /* Evita zoom no iOS */
        border-width: 2px;
      }

      .periodo-group {
        gap: 8px;
      }

      .periodo-group select {
        width: 40%;
      }

      .periodo-group input {
        width: 60%;
      }

      .btn {
        padding: 18px;
        font-size: 18px;
        margin-top: 15px;
        border-radius: 8px;
      }

      .resultado {
        font-size: 15px;
        padding: 15px;
        margin-top: 15px;
        text-align: center;
      }

      .erro {
        font-size: 13px;
        padding: 15px;
        margin-top: 15px;
      }

      canvas {
        margin-top: 15px;
      }
    }

    /* RESPONSIVIDADE PARA SMARTPHONES PEQUENOS */
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }

      .container {
        padding: 15px;
        margin: 5px;
      }

      h1 {
        font-size: 18px;
      }

      .input-group input, .input-group select {
        padding: 12px;
      }

      .periodo-group {
        flex-direction: column;
        gap: 12px;
      }

      .periodo-group select,
      .periodo-group input {
        width: 100%;
      }

      .btn {
        padding: 16px;
        font-size: 16px;
      }
    }

    /* RESPONSIVIDADE PARA TABLETS */
    @media (min-width: 769px) and (max-width: 1024px) {
      .container {
        max-width: 700px;
        padding: 35px;
      }

      h1 {
        font-size: 24px;
      }

      .input-group input, .input-group select {
        padding: 12px;
        font-size: 15px;
      }
    }

    /* RESPONSIVIDADE PARA DESKTOPS GRANDES */
    @media (min-width: 1200px) {
      .container {
        max-width: 800px;
        padding: 40px;
      }

      h1 {
        font-size: 26px;
      }

      .input-group input, .input-group select {
        padding: 14px;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Calculadora de Juros Compostos</h1>
    <p>Simule o crescimento do seu investimento com juros compostos.</p>

    <div class="input-group">
      <label>Valor inicial (R$)</label>
      <input type="text" id="valorInicial" placeholder="R$ 10.000,00" oninput="aplicarMascaraMoeda(this)" onblur="aplicarMascaraMoeda(this)">
    </div>

    <div class="input-group">
      <label>Valor mensal (R$)</label>
      <input type="text" id="valorMensal" placeholder="R$ 500,00" oninput="aplicarMascaraMoeda(this)" onblur="aplicarMascaraMoeda(this)">
    </div>

    <div class="input-group">
      <label>Taxa de juros (% ao ano)</label>
      <input type="text" id="taxaJuros" placeholder="12,50%" oninput="aplicarMascaraPorcentagem(this)" onblur="aplicarMascaraPorcentagem(this)">
    </div>

    <div class="input-group">
      <label>Período</label>
      <div class="periodo-group">
        <select id="periodoTipo">
          <option value="anos">Anos</option>
          <option value="meses">Meses</option>
        </select>
        <input type="number" id="periodo" placeholder="Ex: 5">
      </div>
    </div>

    <button class="btn" onclick="calcular()">Calcular</button>

    <div class="erro" id="erro"></div>

    <div class="resultado" id="resultado"></div>

    <canvas id="grafico"></canvas>
  </div>

  <script>
    let chart;

    // Função para aplicar máscara de moeda
    function aplicarMascaraMoeda(input) {
      let valor = input.value;
      
      // Remove tudo que não é número
      valor = valor.replace(/\D/g, '');
      
      if (valor === '') {
        input.value = '';
        return;
      }
      
      // Converte para centavos
      valor = parseFloat(valor) / 100;
      
      // Formata como moeda brasileira
      input.value = 'R$ ' + valor.toLocaleString('pt-BR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    // Função para aplicar máscara de porcentagem
    function aplicarMascaraPorcentagem(input) {
      let valor = input.value;
      
      // Remove tudo que não é número ou vírgula/ponto
      valor = valor.replace(/[^\d,\.]/g, '');
      
      // Substitui ponto por vírgula para padrão brasileiro
      valor = valor.replace(/\./g, ',');
      
      // Garante apenas uma vírgula
      let partes = valor.split(',');
      if (partes.length > 2) {
        valor = partes[0] + ',' + partes.slice(1).join('');
      }
      
      // Limita casas decimais a 2
      if (partes[1] && partes[1].length > 2) {
        valor = partes[0] + ',' + partes[1].substring(0, 2);
      }
      
      if (valor !== '') {
        input.value = valor + '%';
      } else {
        input.value = '';
      }
    }

    // Função para extrair valor numérico dos campos com máscara
    function extrairValorNumerico(valor, tipo) {
      if (!valor) return 0;
      
      if (tipo === 'moeda') {
        // Remove R$, pontos e substitui vírgula por ponto
        return parseFloat(valor.replace(/R\$\s?/g, '').replace(/\./g, '').replace(/,/g, '.')) || 0;
      } else if (tipo === 'porcentagem') {
        // Remove % e substitui vírgula por ponto
        return parseFloat(valor.replace(/%/g, '').replace(/,/g, '.')) || 0;
      }
      
      return parseFloat(valor) || 0;
    }

    function limparErros() {
      // Remove classes de erro dos campos
      document.querySelectorAll('.erro-campo').forEach(campo => {
        campo.classList.remove('erro-campo');
      });
      
      // Esconde mensagem de erro
      document.getElementById('erro').style.display = 'none';
    }

    function validarCampos() {
      const campos = [
        { id: 'valorInicial', nome: 'Valor inicial', obrigatorio: false },
        { id: 'valorMensal', nome: 'Valor mensal', obrigatorio: false },
        { id: 'taxaJuros', nome: 'Taxa de juros', obrigatorio: true },
        { id: 'periodo', nome: 'Período', obrigatorio: true }
      ];

      let camposComErro = [];
      let valorInicialPreenchido = false;
      let valorMensalPreenchido = false;

      campos.forEach(campo => {
        const elemento = document.getElementById(campo.id);
        const valor = elemento.value.trim();
        let valorNumerico = 0;
        
        // Extrai valor numérico baseado no tipo do campo
        if (campo.id === 'valorInicial' || campo.id === 'valorMensal') {
          valorNumerico = extrairValorNumerico(valor, 'moeda');
        } else if (campo.id === 'taxaJuros') {
          valorNumerico = extrairValorNumerico(valor, 'porcentagem');
        } else {
          valorNumerico = parseFloat(valor);
        }
        
        // Verifica se é obrigatório e está vazio
        if (campo.obrigatorio && (!valor || valorNumerico <= 0)) {
          elemento.classList.add('erro-campo');
          camposComErro.push(campo.nome);
        }
        
        // Verifica se valor inicial ou mensal foram preenchidos
        if (campo.id === 'valorInicial' && valor && valorNumerico > 0) {
          valorInicialPreenchido = true;
        }
        if (campo.id === 'valorMensal' && valor && valorNumerico > 0) {
          valorMensalPreenchido = true;
        }
      });

      // Pelo menos um dos valores (inicial ou mensal) deve ser preenchido
      if (!valorInicialPreenchido && !valorMensalPreenchido) {
        document.getElementById('valorInicial').classList.add('erro-campo');
        document.getElementById('valorMensal').classList.add('erro-campo');
        camposComErro.push('Valor inicial ou Valor mensal (pelo menos um deve ser preenchido)');
      }

      return camposComErro;
    }

    function exibirErro(erros) {
      const divErro = document.getElementById('erro');
      let mensagem = 'Por favor, corrija os seguintes campos:\n';
      erros.forEach(erro => {
        mensagem += '• ' + erro + '\n';
      });
      
      divErro.textContent = mensagem;
      divErro.style.display = 'block';
    }

    function calcular() {
      // Limpa erros anteriores
      limparErros();
      
      // Valida campos
      const erros = validarCampos();
      if (erros.length > 0) {
        exibirErro(erros);
        return;
      }

      let valorInicial = extrairValorNumerico(document.getElementById('valorInicial').value, 'moeda');
      let valorMensal = extrairValorNumerico(document.getElementById('valorMensal').value, 'moeda');
      let taxaJuros = extrairValorNumerico(document.getElementById('taxaJuros').value, 'porcentagem') / 100;
      let periodo = parseInt(document.getElementById('periodo').value) || 0;
      let periodoTipo = document.getElementById('periodoTipo').value;

      // Definir meses
      let meses = periodoTipo === "anos" ? periodo * 12 : periodo;

      // Converter juros anual para mensal
      let taxaMensal = Math.pow(1 + taxaJuros, 1/12) - 1;

      let historico = [];
      let saldo = valorInicial;
      historico.push(saldo);

      for (let i = 1; i <= meses; i++) {
        saldo = saldo * (1 + taxaMensal) + valorMensal;
        historico.push(saldo);
      }

      document.getElementById('resultado').innerText =
        "Valor final: R$ " + saldo.toLocaleString('pt-BR', { minimumFractionDigits: 2 });

      // Criar labels dos meses
      let labels = [];
      for (let i = 0; i <= meses; i++) {
        labels.push(i + "º mês");
      }

      // Destruir gráfico antigo antes de recriar
      if (chart) {
        chart.destroy();
      }

      let ctx = document.getElementById('grafico').getContext('2d');
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Evolução do investimento',
            data: historico,
            borderColor: '#3949ab',
            backgroundColor: 'rgba(57,73,171,0.2)',
            fill: true,
            tension: 0.2
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                callback: function(value) {
                  return 'R$ ' + value.toLocaleString('pt-BR');
                }
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
